<!--
  Generated template for the PickingFormPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
    <ion-navbar>
      <button ion-button menuToggle>
        <ion-icon name="menu"></ion-icon>
      </button>
      <ion-title>{{ stock_move_data['reference'] || 'Nuevo movimiento' }}</ion-title>
    <ion-buttons end>
    <button ion-button icon-only item-end (click)="lee_form()">
      <ion-icon name="megaphone"></ion-icon>
    </button>
    <button ion-button icon-only item-end (click)="change_escuchando()">
      <ion-icon *ngIf="escuchando" name="mic"></ion-icon>
      <ion-icon *ngIf="!escuchando" name="mic-off"></ion-icon>
    </button>
      
      <button ion-button icon-only item-end (click)="toggle_scan_form()" color="primary">
      <ion-icon name="barcode"></ion-icon>
    </button>
    </ion-buttons>
  </ion-navbar>
     
  </ion-header>
  
  <ion-content padding>
    <div>
        <ion-item no-lines>
            <button *ngIf="type == 'list'" ion-button item-start (click)="open_pick(-1)">
                <<
                </button>
                <button ion-button item-start (click)="backToMoveList()">
                Volver
                </button>
                <button  *ngIf="type == 'list'" ion-button item-end (click)="open_pick(1)">
                >>
            </button>
        </ion-item>
    </div>

    <div *ngIf="!new_move_form && stock_move_data">
        <ion-item no-lines>
            <button *ngIf="stock_move_data['state'] == 'confirmed'" color='odoo' padding ion-button item-end (click)="search_quants_apk()">
            Buscar
            </button>
            <button *ngIf="stock_move_data['state'] == 'confirmed'" color='odoo' padding ion-button item-end (click)="forced_quants_apk()">
            Forzar
            </button>
            <button *ngIf="stock_move_data['state'] == 'assigned'" color='odoo' padding ion-button item-end (click)="validate_move_apk()">
            Validar
            </button>
        </ion-item>
    </div>

    <div *ngIf="new_move_form">
        <ion-card>
            <ion-card-header>
                Nuevo movimiento:
            </ion-card-header>
            <ion-card-content>
                <ion-list *ngIf="step <= 4 || step == 'confirm'">
                    <span [ngClass]="{'red-icon': location_error, 'green-icon': location_data && !location_confirm, 'orange-icon': location_confirm }">
                        <strong>
                            Origen: 
                        </strong>
                        {{ location_data['name'] || 'Sin introducir' }} <br/>
                    </span>

                    <span [ngClass]="{'red-icon': product_error, 'green-icon': product_data }">
                        <strong>
                            Producto: 
                        </strong>
                        {{ product_data['product_tmpl_name'] || 'Sin introducir' }} <br>
                    </span>

                    <span *ngIf="available_qty && step == 2" class="blue-icon">
                        <a (click)="move_all_qty(available_qty)">
                            <strong>
                                Cantidad disponible: 
                            </strong>
                        {{ available_qty || 'Sin calcular' }} </a><br>
                    </span>

                    <span *ngIf="available_qty && step != 2">
                        <strong>
                            Cantidad disponible: 
                        </strong>
                        {{ available_qty || 'Sin calcular' }} <br>
                    </span>

                    <span *ngIf="available_qty && product_uom_qty && step == 3" [ngClass]="{'red-icon': qty_error, 'orange-icon': qty_confirm }">
                        <strong>
                            Cantidad hecha/Cantidad demandada: 
                        </strong>
                        {{ qty_done || 'Sin introducir' }} / <a *ngIf="product_uom_qty && step == 3" (click)="check_done_qty(product_uom_qty)">{{ product_uom_qty }}</a> <br>
                    </span>

                    <span *ngIf="available_qty && product_uom_qty && step != 3" [ngClass]="{'red-icon': qty_error, 'green-icon': qty_done }">
                        <strong>
                            Cantidad hecha/Cantidad demandada: 
                        </strong>
                        {{ qty_done || 'Sin introducir' }} / {{ product_uom_qty || 'Sin introducir' }} <br>
                    </span>

                    <span [ngClass]="{'red-icon': location_dest_error, 'green-icon': location_dest_data && !location_dest_confirm, 'orange-icon': location_dest_confirm }">
                        <strong>
                            Destino: 
                        </strong>
                        {{ location_dest_data['name'] || 'Sin introducir' }} <br>
                    </span>
                </ion-list>
                <ion-list *ngIf="step > 4">
                    <span>Actualizando</span>
                </ion-list>
            </ion-card-content>
        </ion-card>
    </div>

    <div *ngIf="!new_move_form && stock_move_data">
        <ion-card>
            <ion-card-header>
              Datos del movimiento:
            </ion-card-header>
            <ion-card-content>
                <ion-list>
                    <span *ngIf="stock_move_data['state']">
                        <strong>
                            Estado:
                        </strong>
                        {{ stock_move_data['state'] }} <br>
                    </span>
                    <span *ngIf="stock_move_data['reference']">
                        <strong>
                            Referencia: 
                        </strong>
                        {{ stock_move_data['reference'] }} <br>
                    </span>

                    <span *ngIf="stock_move_data['location_id']">
                        <strong>
                            Origen: 
                        </strong>
                        {{ stock_move_data['location_id'][1] }} <br/>
                    </span>

                    <span *ngIf="stock_move_data['location_id']">
                        <strong>
                            Destino:
                        </strong>
                        {{ stock_move_data['location_dest_id'][1] }} <br/>
                    </span>

                    <span *ngIf="stock_move_data['product_id']">
                        <strong>
                            Producto:
                        </strong>
                        {{ stock_move_data['product_id'][1] }} <br/>
                    </span>

                    <span *ngIf="stock_move_data['product_uom_qty']">
                        <strong>
                            Demanda:
                        </strong>
                        {{ stock_move_data['product_uom_qty'] }} <br/>
                    </span>

                    <span *ngIf="stock_move_data['date']">
                        <strong>
                            Fecha:
                        </strong>
                        {{ stock_move_data['date'] }} <br/>
                    </span>
                </ion-list>

                <ion-row *ngFor="let move_line of move_line_ids">
                    <ion-col *ngIf="move_line['lot_id'] && stock_move_data['state'] != done && move_line['state'] != done">
                        <a (click)="verificar_qty(move_line['id'])" >LOT:  {{move_line['lot_id'][1]}}</a>
                    </ion-col>
                    <ion-col *ngIf="move_line['lot_id'] && (stock_move_data['state'] == done || move_line['state'] == done)">
                        LOT:  {{move_line['lot_id'][1]}}
                    </ion-col>
                    <ion-col *ngIf="!move_line['lot_id'] && stock_move_data['state'] != done && move_line['state'] != done">
                        <a (click)="verificar_qty(move_line['id'])" >PRO:  {{move_line['product_id'][1]}}</a>
                    </ion-col>
                    <ion-col *ngIf="!move_line['lot_id'] && (stock_move_data['state'] == done || move_line['state'] == done)">
                        PRO:  {{move_line['product_id'][1]}}
                    </ion-col>
                    <ion-col text-end>
                        <ion-badge *ngIf="move_line['state'] != 'done'"  color="odoo" [ngClass]="{'red-icon': move_line['qty_status'] == 'error', 'green-icon': move_line['qty_status'] == 'done' }">
                            QTY:  {{ move_line['qty_done']}} de {{ move_line['ordered_qty']}}
                        </ion-badge>
                        <ion-badge *ngIf="move_line['state'] == 'done'" color="state_done">
                            QTY:  {{ move_line['qty_done']}} de {{ move_line['ordered_qty']}}
                        </ion-badge>
                    </ion-col>
                </ion-row>
            </ion-card-content>
        </ion-card>
    </div>
  </ion-content>
  
  <ion-footer>
    <form [formGroup]="ScanReader" class ="alignBottom" *ngIf="hide_scan_form">
      <ion-item>
        <ion-label color="primary" item-start>Scan: </ion-label>
        <ion-input #scan [formControl]="ScanReader.controls['scan']" type="text" name="scan" placeholder = "Scan" ></ion-input>
        <button ion-button icon-only item-end clear (click)="submitScan(ScanReader.value)">
          <ion-icon name="barcode"></ion-icon>
        </button>
      </ion-item>   
    </form>
  </ion-footer>
  
  